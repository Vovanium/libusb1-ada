# Libusb bindings notes and progress

## General notes

### How libusb bindings are organized?

Bindings for libusb1 library are placed in ada package USB.Libusb1.
All its entities are imported using their corresponding names,
however several changes are made:
- prefix "libusb_" is removed from all entities;
- pointer types got "_Access" suffix;
- pointer array pointers implemented through instantion Interfaces.C.Pointers with "_Lists" suffix;
- opaque pointers are implemented using System.Address;
- several individual changes are made, see list below.

## Progress

- [ ] Module Library initialization/deinitialization
  - [ ] Types
    - [x] version (under name Lib_Version)
    - [x] context (opaque)
    - [x] log_level
    - [ ] option
  - [ ] Subprograms
    - [x] init (under name Lib_Init)
    - [x] exit (under name Lib_Exit)
    - [x] set_debug
    - [ ] set_option (vararg function, so c wrappers are required)
- [x] Module Device handling and enumeration
  - [x] Types
    - [x] device (opaque)
    - [x] device_handle (opaque)
    - [x] speed
    - [x] supported_speede (under name USB.Protocol.Superspeed_USB_Device_Capability_Descriptors.Speeds_Supported)
    - [x] usb_2_0_extension_attributes (under name USB.Protocol.USB_2_0_Extension_Descriptors.Attributes)
    - [x] ss_usb_device_capability_attributese (under name USB.Protocol.Superspeed_USB_Device_Capability_Descriptors.Attributes)
    - [x] bos_type (under name USB.Protocol.BOS_Device_Capability_Type)
  - [x] Subprograms
    - [x] get_device_list
    - [x] free_device_list
    - [x] get_bus_number
    - [x] get_port_number
    - [x] get_port_numbers
    - [x] get_port_path
    - [x] get_parent
    - [x] get_device_address
    - [x] get_device_speed
    - [x] get_max_packet_size
    - [x] get_max_iso_packet_size
    - [x] ref_device
    - [x] unref_device
    - [x] open
    - [x] open_device_with_vid_pid
    - [x] close
    - [x] get_device
    - [x] get_cofiguration
    - [x] set_configuration
    - [x] claim_interface
    - [x] release_interface
    - [x] set_interface_alt_setting
    - [x] clear_halt
    - [x] reset_device
    - [x] kernel_driver_active
    - [x] detach_kerel_driver
    - [x] attach_kernel_driver
    - [x] set_auto_detach_kernel_driver
- [ ] Module USB descriptors
  - [ ] Types
    - [x] device_descriptor (under name USB.Protocol.Device_Descriptor)
    - [x] endpoint_descriptor
    - [x] interface_descriptor
    - [x] interface (under name Interface_List)
    - [x] config_descriptor (under name Configuration_Descriptor)
    - [x] ss_endpoint_companion_descriptor
    - [x] bos_dev_capability_descriptor (under name USB.Protocol.BOS_Device_Capability_Descriptor)
    - [x] bos_descriptor (in USB.Protocol)
    - [x] usb_2_0_extension_descriptor (under name USB.Protocol.USB_2_0_Extension_Descriptors.Descriptor)
    - [x] ss_usb_device_capability_descriptor (under name USB.Protocol.Superspeed_USB_Device_Capability_Descriptor)
    - [x] containter_id_descriptor (under name USB.Protocol.Container_Id_Descriptors.Descriptor)
    - [x] class_code (under name USB.Protocol.Class_Code)
    - [x] descriptor_type (under name USB.Protocol.Descriptor_Type)
    - [ ] endpoint_direction
    - [x] transfer_type
    - [x] iso_sync_type (under name USB.Protocol.Endpoint_Desctiptors.Iso_Sync_Type)
    - [x] iso_usage_type (under name USB.Protocol.Endpoint_Desctiptors.Iso_Usage_Type)
  - [x] Subprograms
    - [x] get_device_descriptor
    - [x] get_active_config_descriptor
    - [x] get_config_descriptor
    - [x] get_config_descriptor_by_value
    - [x] free_config_descriptor
    - [x] get_ss_endpoint_companion_descriptor
    - [x] free_ss_endpoint_companion_descrptor
    - [x] get_bos_descriptor
    - [x] free_bos_descriptor
    - [x] get_usb_2_0_extension_descriptor
    - [x] free_usb_2_0_extension_descriptor
    - [x] get_ss_usb_device_capability_descriptor
    - [x] free_ss_usb_device_capability_descriptor
    - [x] get_container_id_descriptor
    - [x] free_container_id_descriptor
    - [x] get_string_descriptor_ascii
    - [ ] get_descriptor (it is a static function in header file, need to reimplement)
    - [ ] get_string_descriptor (it is a static function in header file, need to reimplement)
- [x] Module Synchronous device I/O
  - [x] Subprograms
    - [x] control_transfer
    - [x] bulk_transfer
    - [x] interrupt_transfer
- [ ] Module Asynchronous device I/O
  - [x] Types
    - [x] control_setup (under name USB.Protocol.Control_Setup)
    - [x] iso_packet_descriptor
    - [x] transfer
    - [x] transfer_cb_fn
    - [x] transfer_status
    - [x] transfer_flags
  - [ ] Subprograms
    - [x] alloc_streams
    - [x] free_streams
    - [ ] dev_mem_alloc
    - [ ] dev_mem_free
    - [x] alloc_transfer
    - [x] free_transfer
    - [x] submit_transfer
    - [x] cancel_transfer
    - [x] transfer_set_stream_id
    - [x] transfer_get_stream_id
    - [ ] control_transfer_get_data (static)
    - [ ] control_transfer_get_setup (static)
    - [ ] fill_control_transfer (static)
    - [ ] fill_bulk_transfer (static)
    - [ ] fill_bulk_stream_transfer (static)
    - [ ] fill_interrupt_transfer (static)
    - [ ] fill_iso_transfer (static)
    - [ ] set_iso_packet_lengths (static)
    - [ ] get_iso_packet_buffer (static)
    - [ ] get_iso_packet_buffer_simple (static)
- [ ] Module Polling and timing
  - [x] Types
    - [x] pollfd
    - [x] pollfd_added_cb
    - [x] pollfd_removed_cb
  - [ ] Subprograms
    - [x] try_lock_events
    - [x] lock_events
    - [x] unlock_events
    - [x] event_handling_ok
    - [x] event_handler_active
    - [ ] interrupt_event_handler
    - [x] lock_event_waiters
    - [x] unlock_event_waiters
    - [x] wait_for_events (timeval undefined)
    - [x] handle_events_timeout_completed
    - [x] handle_events_timeout
    - [x] handle_events
    - [x] handle_events_completed
    - [x] handle_events_locked
    - [x] pollfds_handle_timeouts
    - [x] get_next_timeout
    - [x] set_pollfd_notifiers
    - [x] get_pollfds
    - [x] free_polldfs
- [x] Module Device hotplug event notification
  - [x] Constants
    - [x] HOTPLUG_MATCH_ANY
  - [x] Types
    - [x] hotplug_callback_handle
    - [x] hotplug_callback_fn
    - [x] hotplug_flag
    - [x] hotplug_event
  - [x] Subprograms
    - [x] hotplug register_callback
    - [x] hotplug_deregister_callback
- [ ] Module Miscellaneous
  - [x] Constants
    - [x] API_Version
  - [x] Types
    - [x] standard_request (under name USB.Protocol.Standard_Request_Code)
    - [x] request_type (under name USB.Protocol.Request_Type)
    - [x] request_recipient (under name USB.Protocol.Request_Recipient)
    - [x] error (under name status) (it seems it coulb be redefined as a set of integer constants)
    - [x] capability (under name lib_capability)
  - [x] Subprograms
    - [x] has_capability
    - [x] error_name
    - [x] get_version
    - [x] setlocale
    - [x] strerror
  - [ ] Variables
    - [ ] usbi_locale_supported (variable has no "libusb_" prefix)